#!/usr/bin/env python3
"""Apply environment variables to values.yaml files"""

import json
import os
from jinja2 import Template

def apply_template(jinja2_file, output_file, replacements):
    """Replace the replacements values in jinja2_file, write to output_file"""
    print(f"Rendering {jinja2_file} to {output_file}")
    with open(jinja2_file, "r") as j2_file:
        j2_text = j2_file.read()
    template = Template(j2_text)
    replaced_text = template.render(**replacements)
    with open(output_file, "w+") as write_file:
        write_file.write(replaced_text)

cat << EOH > helm/kytrade-api/export-values.yaml
API_FQDN: $API_FQDN
SLACK_TOKEN: $SLACK_TOKEN
REDDIT_APP_ID: $REDDIT_APP_ID
REDDIT_APP_SECRET: $REDDIT_APP_SECRET
POSTGRES_HOST: $POSTGRES_HOST
POSTGRES_USER: $POSTGRES_USER
POSTGRES_PASSWORD: $POSTGRES_PASSWORD
DATABASE_NAME: $DATABASE_NAME
REDIS_HOST: $REDIS_HOST
REDIS_USER: $REDIS_USER
REDIS_PASSWORD: $REDIS_PASSWORD
RELEASE: $RELEASE
image:
  tag: "$RELEASE"
EOH

cp helm/kytrade-api/export-values.yaml helm/kytrade-client/export-values.yaml
